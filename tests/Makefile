# c89-compiler/tests/Makefile

STAGE1_DIR := stage1
STAGE2_DIR := stage2
GTEST_DIR := gtest
VECTOR_TEST_DIR := vector_test
LEXER_TEST_DIR := lexer_test
MEMORY_POOL_TEST_DIR := memory_pool_test
SOURCE_TEST_DIRS := $(STAGE1_DIR) $(STAGE2_DIR)
UNIT_TEST_DIRS := $(VECTOR_TEST_DIR) $(LEXER_TEST_DIR) $(MEMORY_POOL_TEST_DIR)
DO_TEST_DIRS := $(STAGE1_DIR) $(UNIT_TEST_DIRS)
DIRS := $(SOURCE_TEST_DIRS) $(UNIT_TEST_DIRS)

SOURCE_TEST_PREFIX := source_test_
UNIT_TEST_PREFIX := unit_test_
DO_TEST_PREFIX := do_test_
CLEAN_PREFIX := clean_
DISTCLEAN_PREFIX := distclean_

SOURCE_TEST_TARGETS := $(addprefix $(SOURCE_TEST_PREFIX),$(SOURCE_TEST_DIRS))
UNIT_TEST_TARGETS := $(addprefix $(UNIT_TEST_PREFIX),$(UNIT_TEST_DIRS))
DO_TEST_TARGETS := $(addprefix $(DO_TEST_PREFIX),$(DO_TEST_DIRS))
CLEAN_TARGETS := $(addprefix $(CLEAN_PREFIX),$(DIRS))
DISTCLEAN_TARGETS := $(addprefix $(DISTCLEAN_PREFIX),$(DIRS))


source_test: $(SOURCE_TEST_TARGETS)

$(SOURCE_TEST_TARGETS): $(SOURCE_TEST_PREFIX)%:
	$(MAKE) -C $* source_test


unit_test: $(UNIT_TEST_TARGETS)

$(UNIT_TEST_TARGETS): $(UNIT_TEST_PREFIX)%:
	$(MAKE) -C $* unit_test


do_test: $(DO_TEST_TARGETS)

$(DO_TEST_TARGETS): $(DO_TEST_PREFIX)%:
	$(MAKE) -C $* do_test


clean: $(CLEAN_TARGETS)

$(CLEAN_TARGETS): $(CLEAN_PREFIX)%:
	$(MAKE) -C $* clean


distclean: $(DISTCLEAN_TARGETS)

$(DISTCLEAN_TARGETS): $(DISTCLEAN_PREFIX)%:
	$(MAKE) -C $* distclean


.PHONY: source_test unit_test do_test clean distclean \
	$(SOURCE_TEST_TARGETS) $(UNIT_TEST_TARGETS) $(DO_TEST_TARGETS) \
	$(CLEAN_TARGETS) $(DISTCLEAN_TARGETS)
